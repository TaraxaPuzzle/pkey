<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wallet Connect Demo</title>

<script src="https://unpkg.com/ethers@6.8.1/dist/ethers.umd.min.js"></script>
<script src="https://unpkg.com/@web3modal/html@2.3.4/dist/index.min.js"></script>
<script src="https://unpkg.com/@web3modal/ethereum@2.3.4/dist/index.min.js"></script>
<script src="https://unpkg.com/@wagmi/core@0.10.1/dist/index.min.js"></script>

<style>
  body { font-family: sans-serif; padding: 2rem; }
  button { font-size: 1rem; padding: 0.5rem 1rem; }
  #walletAddress { margin-top: 1rem; }
</style>
</head>
<body>

<button id="connectBtn">Connect Wallet</button>
<div id="walletAddress"></div>

<script>
  const { w3mConnectors, w3mProvider, EthereumClient } = window.WagmiCore;
  const { Web3Modal } = window.Web3Modal;

  const chains = [{
    id: 841,
    name: "Taraxa Mainnet",
    network: "taraxa",
    nativeCurrency: { decimals: 18, name: "Tara", symbol: "TARA" },
    rpcUrls: { default: ["https://rpc.mainnet.taraxa.io"] },
    blockExplorers: { default: { name: "Taraxa Explorer", url: "https://explorer.mainnet.taraxa.io" } }
  }];

  const projectId = "c3bca9309d970d96c70be0b04f661798";

  const wagmiProvider = w3mProvider({ projectId, chains });
  const wagmiConnectors = w3mConnectors({ projectId, chains });
  const ethereumClient = new EthereumClient(wagmiProvider, wagmiConnectors);

  const web3Modal = new Web3Modal({
    projectId,
    ethereumClient,
    themeMode: "light",
  });

  let provider, signer;

  async function connectWallet() {
    try {
      await web3Modal.open();
      provider = new ethers.BrowserProvider(ethereumClient.getProvider());
      await provider.send("eth_requestAccounts", []);
      signer = await provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletAddress").innerText = `Connected wallet: ${address}`;
      console.log("Connected:", address);
    } catch (err) {
      console.error("Failed to connect wallet:", err);
      alert("Connection failed.");
    }
  }

  document.getElementById("connectBtn").onclick = connectWallet;
</script>

</body>
</html>
